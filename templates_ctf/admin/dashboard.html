{% extends 'ctf_base.html' %}
{% load static %}

{% block title %}Admin Dashboard - CYBER SENTINELS{% endblock %}

{% block extra_css %}
<style>
    .stat-card {
        @apply bg-card border border-border rounded-lg p-6 hover:border-primary/50 transition-all;
    }
    .event-card {
        @apply bg-card border border-border rounded-lg p-6 mb-4 hover:shadow-lg transition-all;
    }
    .state-badge {
        @apply px-3 py-1 rounded-full text-xs font-tech uppercase tracking-wider;
    }
    .state-running { @apply bg-green-600/20 text-green-400 border border-green-600/50; }
    .state-paused { @apply bg-yellow-600/20 text-yellow-400 border border-yellow-600/50; }
    .state-stopped { @apply bg-red-600/20 text-red-400 border border-red-600/50; }
    .state-not_started { @apply bg-gray-600/20 text-gray-400 border border-gray-600/50; }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 pt-24">
    <div class="flex items-center justify-between mb-8">
        <h1 class="text-4xl font-display text-primary">Admin Dashboard</h1>
        <a href="{% url 'events_ctf:admin-live-scoreboard' %}" class="btn-hero px-6 py-3 flex items-center gap-2">
            <span>ðŸ“Š</span>
            <span>Live Scoreboard</span>
        </a>
    </div>
    
    <!-- System Statistics -->
    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8">
        <div class="stat-card">
            <div class="text-3xl font-display text-primary mb-2">{{ stats.total_events }}</div>
            <div class="text-sm text-muted-foreground font-tech uppercase">Total Events</div>
        </div>
        <div class="stat-card">
            <div class="text-3xl font-display text-primary mb-2">{{ stats.active_events }}</div>
            <div class="text-sm text-muted-foreground font-tech uppercase">Active Events</div>
        </div>
        <div class="stat-card">
            <div class="text-3xl font-display text-primary mb-2">{{ stats.total_teams }}</div>
            <div class="text-sm text-muted-foreground font-tech uppercase">Total Teams</div>
        </div>
        <div class="stat-card">
            <div class="text-3xl font-display text-primary mb-2">{{ stats.active_instances }}</div>
            <div class="text-sm text-muted-foreground font-tech uppercase">Active Instances</div>
        </div>
        <div class="stat-card">
            <div class="text-3xl font-display text-primary mb-2">{{ stats.total_submissions }}</div>
            <div class="text-sm text-muted-foreground font-tech uppercase">Submissions</div>
        </div>
        <div class="stat-card">
            <div class="text-3xl font-display text-red-500 mb-2">{{ stats.pending_violations }}</div>
            <div class="text-sm text-muted-foreground font-tech uppercase">Violations</div>
        </div>
    </div>
    
    <!-- Active Events -->
    <div class="mb-8">
        <h2 class="text-2xl font-tech text-foreground mb-4">Active Events</h2>
        {% for event in active_events %}
        <div class="event-card">
            <div class="flex items-center justify-between mb-4">
                <div>
                    <h3 class="text-xl font-tech text-primary mb-2">{{ event.name }} ({{ event.year }})</h3>
                    <span class="state-badge state-{{ event.contest_state }}">{{ event.get_contest_state_display }}</span>
                    <span class="ml-2 text-sm text-muted-foreground">Scoreboard: {{ event.get_scoreboard_state_display }}</span>
                </div>
                <a href="{% url 'events_ctf:admin-event-control' event.id %}" class="btn-hero px-6 py-2">
                    Control Panel
                </a>
            </div>
            <div class="grid grid-cols-4 gap-4 text-sm">
                <div>
                    <span class="text-muted-foreground">Start:</span>
                    <span class="ml-2">{{ event.start_time|date:"M d, Y H:i"|default:"Not set" }}</span>
                </div>
                <div>
                    <span class="text-muted-foreground">End:</span>
                    <span class="ml-2">{{ event.end_time|date:"M d, Y H:i"|default:"Not set" }}</span>
                </div>
                <div>
                    <span class="text-muted-foreground">Last Changed:</span>
                    <span class="ml-2">{{ event.state_changed_at|date:"M d, Y H:i"|default:"Never" }}</span>
                </div>
                <div>
                    <span class="text-muted-foreground">By:</span>
                    <span class="ml-2">{{ event.state_changed_by.username|default:"System" }}</span>
                </div>
            </div>
        </div>
        {% empty %}
        <p class="text-muted-foreground">No active events</p>
        {% endfor %}
    </div>
    
    <!-- Recent Audit Logs -->
    <div>
        <h2 class="text-2xl font-tech text-foreground mb-4">Recent Audit Logs</h2>
        <div class="bg-card border border-border rounded-lg overflow-hidden">
            <table class="w-full">
                <thead class="bg-muted border-b border-border">
                    <tr>
                        <th class="px-4 py-3 text-left font-tech text-sm uppercase text-muted-foreground">Timestamp</th>
                        <th class="px-4 py-3 text-left font-tech text-sm uppercase text-muted-foreground">Action</th>
                        <th class="px-4 py-3 text-left font-tech text-sm uppercase text-muted-foreground">Event</th>
                        <th class="px-4 py-3 text-left font-tech text-sm uppercase text-muted-foreground">Admin</th>
                        <th class="px-4 py-3 text-left font-tech text-sm uppercase text-muted-foreground">Description</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in recent_logs %}
                    <tr class="border-b border-border hover:bg-muted/50">
                        <td class="px-4 py-3 text-sm">{{ log.timestamp|date:"M d, Y H:i:s" }}</td>
                        <td class="px-4 py-3 text-sm font-tech">{{ log.get_action_type_display }}</td>
                        <td class="px-4 py-3 text-sm">{{ log.event.name|default:"-" }}</td>
                        <td class="px-4 py-3 text-sm">{{ log.performed_by.username|default:"System" }}</td>
                        <td class="px-4 py-3 text-sm">{{ log.description|truncatewords:20 }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="px-4 py-8 text-center text-muted-foreground">No audit logs</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

